--ÐÞ×°±¸
--805027
-- [ QUFEI 2007-10-15 15:31 UPDATE BugID 26358 ]
-- ÏûºÄÎïÆ·¶ÔÓ¦±í
x805027_g_NeedItemBonus={
						{sqid01=10300000, sqid02=10302000, sqid03=10304000, sqid04=10305000, sfid={ 30505800, 30505801, 30505802, 30505803, 30505804, 30505805, 30505806 }},		-- ñÒÉÙÎ¢,2008.5.30.Ìí¼Ó30505806Tân mãng th¥n phù c¤p 7¿ÉÒÔÐÞÀíµÍc¤p±ðÉñÆ÷
						{sqid01=10300001, sqid02=10302001, sqid03=10304001, sqid04=10305001, sfid={ 30505801, 30505802, 30505803, 30505804, 30505805, 30505806 }},
						{sqid01=10300002, sqid02=10302002, sqid03=10304002, sqid04=10305002, sfid={ 30505802, 30505803, 30505804, 30505805, 30505806 }},
						{sqid01=10300003, sqid02=10302003, sqid03=10304003, sqid04=10305003, sfid={ 30505803, 30505804, 30505805, 30505806 }},
						{sqid01=10300004, sqid02=10302004, sqid03=10304004, sqid04=10305004, sfid={ 30505804, 30505805, 30505806 }},
						{sqid01=10300005, sqid02=10302005, sqid03=10304005, sqid04=10305005, sfid={ 30505805, 30505806 }},
						--Than Khi Luyen Hon 86 96--
						{sqid01=10310001, sqid02=10310001, sqid03=10310001, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310003, sqid02=10310003, sqid03=10310003, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310005, sqid02=10310005, sqid03=10310005, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310007, sqid02=10310007, sqid03=10310007, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310009, sqid02=10310009, sqid03=10310009, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310011, sqid02=10310011, sqid03=10310011, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310013, sqid02=10310013, sqid03=10310013, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310015, sqid02=10310015, sqid03=10310015, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310017, sqid02=10310017, sqid03=10310017, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310019, sqid02=10310019, sqid03=10310019, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310021, sqid02=10310021, sqid03=10310021, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310023, sqid02=10310023, sqid03=10310023, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310025, sqid02=10310025, sqid03=10310025, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310027, sqid02=10310027, sqid03=10310027, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310029, sqid02=10310029, sqid03=10310029, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310031, sqid02=10310031, sqid03=10310031, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310033, sqid02=10310033, sqid03=10310033, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310035, sqid02=10310035, sqid03=10310035, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310037, sqid02=10310037, sqid03=10310037, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310039, sqid02=10310039, sqid03=10310039, sqid04=10305005, sfid={30505816, 30505817}},
						{sqid01=10310002, sqid02=10310002, sqid03=10310002, sqid04=10305005, sfid={30505817}},
						{sqid01=10310004, sqid02=10310004, sqid03=10310004, sqid04=10305005, sfid={30505817}},
						{sqid01=10310006, sqid02=10310006, sqid03=10310006, sqid04=10305005, sfid={30505817}},
						{sqid01=10310008, sqid02=10310008, sqid03=10310008, sqid04=10305005, sfid={30505817}},
						{sqid01=10310010, sqid02=10310010, sqid03=10310010, sqid04=10305005, sfid={30505817}},
						{sqid01=10310012, sqid02=10310012, sqid03=10310012, sqid04=10305005, sfid={30505817}},
						{sqid01=10310014, sqid02=10310014, sqid03=10310014, sqid04=10305005, sfid={30505817}},
						{sqid01=10310016, sqid02=10310016, sqid03=10310016, sqid04=10305005, sfid={30505817}},
						{sqid01=10310018, sqid02=10310018, sqid03=10310018, sqid04=10305005, sfid={30505817}},
						{sqid01=10310020, sqid02=10310020, sqid03=10310020, sqid04=10305005, sfid={30505817}},
						{sqid01=10310022, sqid02=10310022, sqid03=10310022, sqid04=10305005, sfid={30505817}},
						{sqid01=10310024, sqid02=10310024, sqid03=10310024, sqid04=10305005, sfid={30505817}},
						{sqid01=10310026, sqid02=10310026, sqid03=10310026, sqid04=10305005, sfid={30505817}},
						{sqid01=10310028, sqid02=10310028, sqid03=10310028, sqid04=10305005, sfid={30505817}},
						{sqid01=10310030, sqid02=10310030, sqid03=10310030, sqid04=10305005, sfid={30505817}},
						{sqid01=10310032, sqid02=10310032, sqid03=10310032, sqid04=10305005, sfid={30505817}},
						{sqid01=10310034, sqid02=10310034, sqid03=10310034, sqid04=10305005, sfid={30505817}},
						{sqid01=10310036, sqid02=10310036, sqid03=10310036, sqid04=10305005, sfid={30505817}},
						{sqid01=10310038, sqid02=10310038, sqid03=10310038, sqid04=10305005, sfid={30505817}},
						{sqid01=10310040, sqid02=10310040, sqid03=10310040, sqid04=10305005, sfid={30505817}},

						{sqid01=10310041, sqid02=10310041, sqid03=10310041, sqid04=10310041, sfid={30505816, 30505817}},
						{sqid01=10310043, sqid02=10310043, sqid03=10310043, sqid04=10310043, sfid={30505816, 30505817}},
						{sqid01=10310045, sqid02=10310045, sqid03=10310045, sqid04=10310045, sfid={30505816, 30505817}},
						{sqid01=10310047, sqid02=10310047, sqid03=10310047, sqid04=10310047, sfid={30505816, 30505817}},
						{sqid01=10310049, sqid02=10310049, sqid03=10310049, sqid04=10310049, sfid={30505816, 30505817}},
						{sqid01=10310051, sqid02=10310051, sqid03=10310051, sqid04=10310051, sfid={30505816, 30505817}},
						{sqid01=10310053, sqid02=10310053, sqid03=10310053, sqid04=10310053, sfid={30505816, 30505817}},
						{sqid01=10310055, sqid02=10310055, sqid03=10310055, sqid04=10310055, sfid={30505816, 30505817}},
						{sqid01=10310057, sqid02=10310057, sqid03=10310057, sqid04=10310057, sfid={30505816, 30505817}},
						{sqid01=10310059, sqid02=10310059, sqid03=10310059, sqid04=10310059, sfid={30505816, 30505817}},
						{sqid01=10310042, sqid02=10310042, sqid03=10310042, sqid04=10310042, sfid={30505817}},
						{sqid01=10310044, sqid02=10310044, sqid03=10310044, sqid04=10310044, sfid={30505817}},
						{sqid01=10310046, sqid02=10310046, sqid03=10310046, sqid04=10310046, sfid={30505817}},
						{sqid01=10310048, sqid02=10310048, sqid03=10310048, sqid04=10310048, sfid={30505817}},
						{sqid01=10310050, sqid02=10310050, sqid03=10310050, sqid04=10310050, sfid={30505817}},
						{sqid01=10310052, sqid02=10310052, sqid03=10310052, sqid04=10310052, sfid={30505817}},
						{sqid01=10310054, sqid02=10310054, sqid03=10310054, sqid04=10310054, sfid={30505817}},
						{sqid01=10310056, sqid02=10310056, sqid03=10310056, sqid04=10310056, sfid={30505817}},
						{sqid01=10310058, sqid02=10310058, sqid03=10310058, sqid04=10310058, sfid={30505817}},
						{sqid01=10310060, sqid02=10310060, sqid03=10310060, sqid04=10310060, sfid={30505817}},

						--102--
						{sqid01=10310061, sqid02=10310061, sqid03=10310061, sqid04=10310061, sfid={30505806}},
						{sqid01=10310062, sqid02=10310062, sqid03=10310062, sqid04=10310062, sfid={30505806}},
						{sqid01=10310063, sqid02=10310063, sqid03=10310063, sqid04=10310063, sfid={30505806}},
						{sqid01=10310064, sqid02=10310064, sqid03=10310064, sqid04=10310064, sfid={30505806}},
						{sqid01=10310065, sqid02=10310065, sqid03=10310065, sqid04=10310065, sfid={30505806}},
						{sqid01=10310066, sqid02=10310066, sqid03=10310066, sqid04=10310066, sfid={30505806}},
						{sqid01=10310067, sqid02=10310067, sqid03=10310067, sqid04=10310067, sfid={30505806}},
						{sqid01=10310068, sqid02=10310068, sqid03=10310068, sqid04=10310068, sfid={30505806}},
						{sqid01=10310069, sqid02=10310069, sqid03=10310069, sqid04=10310069, sfid={30505806}},
						{sqid01=10310070, sqid02=10310070, sqid03=10310070, sqid04=10310070, sfid={30505806}},
						{sqid01=10310071, sqid02=10310071, sqid03=10310071, sqid04=10310071, sfid={30505806}},
						{sqid01=10310072, sqid02=10310072, sqid03=10310072, sqid04=10310072, sfid={30505806}},
						{sqid01=10310073, sqid02=10310073, sqid03=10310073, sqid04=10310073, sfid={30505806}},
						{sqid01=10310074, sqid02=10310074, sqid03=10310074, sqid04=10310074, sfid={30505806}},
						{sqid01=10310075, sqid02=10310075, sqid03=10310075, sqid04=10310075, sfid={30505806}},
						{sqid01=10310076, sqid02=10310076, sqid03=10310076, sqid04=10310076, sfid={30505806}},
						{sqid01=10310077, sqid02=10310077, sqid03=10310077, sqid04=10310077, sfid={30505806}},
						{sqid01=10310078, sqid02=10310078, sqid03=10310078, sqid04=10310078, sfid={30505806}},
						{sqid01=10310079, sqid02=10310079, sqid03=10310079, sqid04=10310079, sfid={30505806}},
						{sqid01=10310080, sqid02=10310080, sqid03=10310080, sqid04=10310080, sfid={30505806}},
						{sqid01=10310081, sqid02=10310081, sqid03=10310081, sqid04=10310081, sfid={30505806}},
						{sqid01=10310082, sqid02=10310082, sqid03=10310082, sqid04=10310082, sfid={30505806}},
						{sqid01=10310083, sqid02=10310083, sqid03=10310083, sqid04=10310083, sfid={30505806}},
						{sqid01=10310084, sqid02=10310084, sqid03=10310084, sqid04=10310084, sfid={30505806}},
						{sqid01=10310085, sqid02=10310085, sqid03=10310085, sqid04=10310085, sfid={30505806}},
						{sqid01=10310086, sqid02=10310086, sqid03=10310086, sqid04=10310086, sfid={30505806}},
						{sqid01=10310087, sqid02=10310087, sqid03=10310087, sqid04=10310087, sfid={30505806}},
						{sqid01=10310088, sqid02=10310088, sqid03=10310088, sqid04=10310088, sfid={30505806}},
						{sqid01=10310089, sqid02=10310089, sqid03=10310089, sqid04=10310089, sfid={30505806}},
						{sqid01=10310090, sqid02=10310090, sqid03=10310090, sqid04=10310090, sfid={30505806}},

						--102 Luyen Hon--
						{sqid01=10310091, sqid02=10310091, sqid03=10310091, sqid04=10310091, sfid={30505908}},
						{sqid01=10310092, sqid02=10310092, sqid03=10310092, sqid04=10310092, sfid={30505908}},
						{sqid01=10310093, sqid02=10310093, sqid03=10310093, sqid04=10310093, sfid={30505908}},
						{sqid01=10310094, sqid02=10310094, sqid03=10310094, sqid04=10310094, sfid={30505908}},
						{sqid01=10310095, sqid02=10310095, sqid03=10310095, sqid04=10310095, sfid={30505908}},
						{sqid01=10310096, sqid02=10310096, sqid03=10310096, sqid04=10310096, sfid={30505908}},
						{sqid01=10310097, sqid02=10310097, sqid03=10310097, sqid04=10310097, sfid={30505908}},
						{sqid01=10310098, sqid02=10310098, sqid03=10310098, sqid04=10310098, sfid={30505908}},
						{sqid01=10310099, sqid02=10310099, sqid03=10310099, sqid04=10310099, sfid={30505908}},
						{sqid01=10310100, sqid02=10310100, sqid03=10310100, sqid04=10310100, sfid={30505908}},
						{sqid01=10310101, sqid02=10310101, sqid03=10310101, sqid04=10310101, sfid={30505908}},
						{sqid01=10310102, sqid02=10310102, sqid03=10310102, sqid04=10310102, sfid={30505908}},
						{sqid01=10310103, sqid02=10310103, sqid03=10310103, sqid04=10310103, sfid={30505908}},
						{sqid01=10310104, sqid02=10310104, sqid03=10310104, sqid04=10310104, sfid={30505908}},
						{sqid01=10310105, sqid02=10310105, sqid03=10310105, sqid04=10310105, sfid={30505908}},
						{sqid01=10310106, sqid02=10310106, sqid03=10310106, sqid04=10310106, sfid={30505908}},
						{sqid01=10310107, sqid02=10310107, sqid03=10310107, sqid04=10310107, sfid={30505908}},
						{sqid01=10310108, sqid02=10310108, sqid03=10310108, sqid04=10310108, sfid={30505908}},
						{sqid01=10310109, sqid02=10310109, sqid03=10310109, sqid04=10310109, sfid={30505908}},
						{sqid01=10310110, sqid02=10310110, sqid03=10310110, sqid04=10310110, sfid={30505908}},
						{sqid01=10310111, sqid02=10310111, sqid03=10310111, sqid04=10310111, sfid={30505908}},
						{sqid01=10310112, sqid02=10310112, sqid03=10310112, sqid04=10310112, sfid={30505908}},
						{sqid01=10310113, sqid02=10310113, sqid03=10310113, sqid04=10310113, sfid={30505908}},
						{sqid01=10310114, sqid02=10310114, sqid03=10310114, sqid04=10310114, sfid={30505908}},
						{sqid01=10310115, sqid02=10310115, sqid03=10310115, sqid04=10310115, sfid={30505908}},
						{sqid01=10310116, sqid02=10310116, sqid03=10310116, sqid04=10310116, sfid={30505908}},
						{sqid01=10310117, sqid02=10310117, sqid03=10310117, sqid04=10310117, sfid={30505908}},
						{sqid01=10310118, sqid02=10310118, sqid03=10310118, sqid04=10310118, sfid={30505908}},
						{sqid01=10310119, sqid02=10310119, sqid03=10310119, sqid04=10310119, sfid={30505908}},
						{sqid01=10310120, sqid02=10310120, sqid03=10310120, sqid04=10310120, sfid={30505908}},
						{sqid01=10310121, sqid02=10310121, sqid03=10310121, sqid04=10310121, sfid={30505908}},
						{sqid01=10310122, sqid02=10310122, sqid03=10310122, sqid04=10310122, sfid={30505908}},
						{sqid01=10310123, sqid02=10310123, sqid03=10310123, sqid04=10310123, sfid={30505908}},
						{sqid01=10310124, sqid02=10310124, sqid03=10310124, sqid04=10310124, sfid={30505908}},
						{sqid01=10310125, sqid02=10310125, sqid03=10310125, sqid04=10310125, sfid={30505908}},
						{sqid01=10310126, sqid02=10310126, sqid03=10310126, sqid04=10310126, sfid={30505908}},
						{sqid01=10310127, sqid02=10310127, sqid03=10310127, sqid04=10310127, sfid={30505908}},
						{sqid01=10310128, sqid02=10310128, sqid03=10310128, sqid04=10310128, sfid={30505908}},
						{sqid01=10310129, sqid02=10310129, sqid03=10310129, sqid04=10310129, sfid={30505908}},
						{sqid01=10310130, sqid02=10310130, sqid03=10310130, sqid04=10310130, sfid={30505908}},
						{sqid01=10310131, sqid02=10310131, sqid03=10310131, sqid04=10310131, sfid={30505908}},
						{sqid01=10310132, sqid02=10310132, sqid03=10310132, sqid04=10310132, sfid={30505908}},
						{sqid01=10310133, sqid02=10310133, sqid03=10310133, sqid04=10310133, sfid={30505908}},
						{sqid01=10310134, sqid02=10310134, sqid03=10310134, sqid04=10310134, sfid={30505908}},
						{sqid01=10310135, sqid02=10310135, sqid03=10310135, sqid04=10310135, sfid={30505908}},
						{sqid01=10310136, sqid02=10310136, sqid03=10310136, sqid04=10310136, sfid={30505908}},
						{sqid01=10310137, sqid02=10310137, sqid03=10310137, sqid04=10310137, sfid={30505908}},
						{sqid01=10310138, sqid02=10310138, sqid03=10310138, sqid04=10310138, sfid={30505908}},
						{sqid01=10310139, sqid02=10310139, sqid03=10310139, sqid04=10310139, sfid={30505908}},
						{sqid01=10310140, sqid02=10310140, sqid03=10310140, sqid04=10310140, sfid={30505908}},
						{sqid01=10310141, sqid02=10310141, sqid03=10310141, sqid04=10310141, sfid={30505908}},
						{sqid01=10310142, sqid02=10310142, sqid03=10310142, sqid04=10310142, sfid={30505908}},
						{sqid01=10310143, sqid02=10310143, sqid03=10310143, sqid04=10310143, sfid={30505908}},
						{sqid01=10310144, sqid02=10310144, sqid03=10310144, sqid04=10310144, sfid={30505908}},
						{sqid01=10310145, sqid02=10310145, sqid03=10310145, sqid04=10310145, sfid={30505908}},
						{sqid01=10310146, sqid02=10310146, sqid03=10310146, sqid04=10310146, sfid={30505908}},
						{sqid01=10310147, sqid02=10310147, sqid03=10310147, sqid04=10310147, sfid={30505908}},
						{sqid01=10310148, sqid02=10310148, sqid03=10310148, sqid04=10310148, sfid={30505908}},
						{sqid01=10310149, sqid02=10310149, sqid03=10310149, sqid04=10310149, sfid={30505908}},
						{sqid01=10310150, sqid02=10310150, sqid03=10310150, sqid04=10310150, sfid={30505908}},
						{sqid01=10310151, sqid02=10310151, sqid03=10310151, sqid04=10310151, sfid={30505908}},
						{sqid01=10310152, sqid02=10310152, sqid03=10310152, sqid04=10310152, sfid={30505908}},
						{sqid01=10310153, sqid02=10310153, sqid03=10310153, sqid04=10310153, sfid={30505908}},
						{sqid01=10310154, sqid02=10310154, sqid03=10310154, sqid04=10310154, sfid={30505908}},
						{sqid01=10310155, sqid02=10310155, sqid03=10310155, sqid04=10310155, sfid={30505908}},
						{sqid01=10310156, sqid02=10310156, sqid03=10310156, sqid04=10310156, sfid={30505908}},
						{sqid01=10310157, sqid02=10310157, sqid03=10310157, sqid04=10310157, sfid={30505908}},
						{sqid01=10310158, sqid02=10310158, sqid03=10310158, sqid04=10310158, sfid={30505908}},
						{sqid01=10310159, sqid02=10310159, sqid03=10310159, sqid04=10310159, sfid={30505908}},
						{sqid01=10310160, sqid02=10310160, sqid03=10310160, sqid04=10310160, sfid={30505908}},
						{sqid01=10310161, sqid02=10310161, sqid03=10310161, sqid04=10310161, sfid={30505908}},
						{sqid01=10310162, sqid02=10310162, sqid03=10310162, sqid04=10310162, sfid={30505908}},
						{sqid01=10310163, sqid02=10310163, sqid03=10310163, sqid04=10310163, sfid={30505908}},
						{sqid01=10310164, sqid02=10310164, sqid03=10310164, sqid04=10310164, sfid={30505908}},
						{sqid01=10310165, sqid02=10310165, sqid03=10310165, sqid04=10310165, sfid={30505908}},
						{sqid01=10310166, sqid02=10310166, sqid03=10310166, sqid04=10310166, sfid={30505908}},
						{sqid01=10310167, sqid02=10310167, sqid03=10310167, sqid04=10310167, sfid={30505908}},
						{sqid01=10310168, sqid02=10310168, sqid03=10310168, sqid04=10310168, sfid={30505908}},
						{sqid01=10310169, sqid02=10310169, sqid03=10310169, sqid04=10310169, sfid={30505908}},
						{sqid01=10310170, sqid02=10310170, sqid03=10310170, sqid04=10310170, sfid={30505908}},
						{sqid01=10310171, sqid02=10310171, sqid03=10310171, sqid04=10310171, sfid={30505908}},
						{sqid01=10310172, sqid02=10310172, sqid03=10310172, sqid04=10310172, sfid={30505908}},
						{sqid01=10310173, sqid02=10310173, sqid03=10310173, sqid04=10310173, sfid={30505908}},
						{sqid01=10310174, sqid02=10310174, sqid03=10310174, sqid04=10310174, sfid={30505908}},
						{sqid01=10310175, sqid02=10310175, sqid03=10310175, sqid04=10310175, sfid={30505908}},
						{sqid01=10310176, sqid02=10310176, sqid03=10310176, sqid04=10310176, sfid={30505908}},
						{sqid01=10310177, sqid02=10310177, sqid03=10310177, sqid04=10310177, sfid={30505908}},
						{sqid01=10310178, sqid02=10310178, sqid03=10310178, sqid04=10310178, sfid={30505908}},
						{sqid01=10310179, sqid02=10310179, sqid03=10310179, sqid04=10310179, sfid={30505908}},
						{sqid01=10310180, sqid02=10310180, sqid03=10310180, sqid04=10310180, sfid={30505908}},
						}

x805027_g_SHENQI_BEGIN = 10300000
x805027_g_SHENQI_END = 10310180
x805027_g_ZHUCAI_INDEX = 0
x805027_g_Impact_Complete_Repair = 150

-- Éñ²ÄÏûºÄtoÕ ðµ ÊýÁ¿
x805027_g_ShenCaiCount	= 1

function x805027_OnEquipRepair( sceneId, selfId, itemId)
--mµt Ð©Ìõ¼þÅÐ¶Ï
--ÐÞÀí
--Íê³É	
	
	
	local price = 0
	local cailiaoList = 0
	local cailiaoID = 1
	local ItemIndex = LuaFnGetItemTableIndexByIndex(sceneId, selfId, itemId)
		

	if ItemIndex >= x805027_g_SHENQI_BEGIN and ItemIndex <= x805027_g_SHENQI_END then	
		price = 0
		
		for i, item in x805027_g_NeedItemBonus do								
			if ItemIndex == item.sqid01
				 or ItemIndex == item.sqid02
				 or ItemIndex == item.sqid03
				 or ItemIndex == item.sqid04 then
				 cailiaoList = item.sfid
				 break
			end
		end
						

		if cailiaoList ~= 0 then
							
			for j, cailiao in cailiaoList do
					
				if LuaFnGetAvailableItemCount( sceneId, selfId, cailiao ) > 0 then
					cailiaoID = cailiao
					break
				end
			end
			
		end
		

		x805027_g_ZHUCAI_INDEX = cailiaoID

		local ItemCount = LuaFnGetAvailableItemCount( sceneId, selfId, cailiaoID )
		
		if ItemCount < 1 then
			BeginEvent(sceneId)
			local strNotice = "Các hÕ thiªu ".."#{_ITEM"..(cailiaoList[1]).."}"
			AddText(sceneId, strNotice)
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId)
			Msg2Player(sceneId,selfId, strNotice, 8)			
	 		return 0
		end
		
	else				
		x805027_g_ZHUCAI_INDEX = 0
		price = GetHighRepairPrice(sceneId, selfId, itemId)
	end

	if price < 0 then
		BeginEvent(sceneId)
		AddText(sceneId,"Trang b¸ cüa các hÕ ðã hªt s¯ l¥n sæa chØa")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId)
		return
	end
	

	--PrintStr(sceneId.."--"..selfId.."--"..itemId.."--"..price)
	
	ret = DoHighRepair( sceneId, selfId, itemId, price)
	if ret == -1 then
		BeginEvent(sceneId)
		AddText(sceneId,"Trang b¸ này không th¬ sØa chæa sØa chæa")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId)
		Msg2Player(sceneId,selfId,"Trang b¸ này không th¬ sØa chæa sØa chæa", 8)
	elseif ret == -2 then
		BeginEvent(sceneId)
		AddText(sceneId,"Ngân lßþng cüa ngß½i không th¬ chi trä cho chi phí sØa chæa")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId)
		Msg2Player(sceneId,selfId,"#RNgân lßþng cüa ngß½i không th¬ chi trä cho chi phí sØa chæa", 8)
	elseif ret == -4 then
		BeginEvent(sceneId)
		AddText(sceneId,"SØa chæa th¤t bÕi, s¯ l¥n trang b¸ cüa các hÕ có th¬ sØa chæa -1")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId)
		Msg2Player(sceneId,selfId,"SØa chæa th¤t bÕi, s¯ l¥n trang b¸ cüa các hÕ có th¬ sØa chæa #R-1", 8)
	elseif ret == -5 then
		BeginEvent(sceneId)
		AddText(sceneId,"Trong quá trình sØa chæa")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId)
		Msg2Player(sceneId,selfId,"Trong quá trình sØa chæa", 8)
	elseif ret == -6 then
		BeginEvent(sceneId)
		AddText(sceneId,"V§t ph¦m không b¸ t±n hÕi, không c¥n sØa")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId)
		Msg2Player(sceneId,selfId,"V§t ph¦m không b¸ t±n hÕi, không c¥n sØa", 8)
	elseif ret == 0 then
		
		if x805027_g_ZHUCAI_INDEX ~= 0 then
			local bagbegin = GetBasicBagStartPos(sceneId, selfId)
			local bagend   = GetBasicBagEndPos(sceneId, selfId)
			local ItemEX
			--  ðÕt ðßþcµ±Ç°¿ÉÒÔÏûºÄtoÕ ðµ µÚmµt cáiÉñ²ÄTÕi ±³°üÖÐtoÕ ðµ Î»ÖÃ	
			local scbagpos = -1
			for i=bagbegin, bagend do
				if LuaFnIsItemAvailable( sceneId, selfId, i ) == 1 then
					ItemEX = LuaFnGetItemTableIndexByIndex(sceneId, selfId, i)			
					if ItemEX == x805027_g_ZHUCAI_INDEX then						
						scbagpos = i
						break
					end		
				end
			end
						
			if scbagpos == -1 then
				BeginEvent(sceneId)
				local strNotice = "ÄãÈ±ÉÙ".."#{_ITEM"..(x805027_g_ZHUCAI_INDEX).."}"
				AddText(sceneId, strNotice)
				EndEvent(sceneId)
				DispatchMissionTips(sceneId,selfId)
				Msg2Player(sceneId,selfId, strNotice, 8)				 			
			  return 0
			end
			
			local res = LuaFnDelAvailableItem(sceneId, selfId, x805027_g_ZHUCAI_INDEX, x805027_g_ShenCaiCount)
			
			if res == 0 then
				BeginEvent(sceneId)
				AddText(sceneId,"Trong quá trình sØa chæa")
				EndEvent(sceneId)
				DispatchMissionTips(sceneId,selfId)
				Msg2Player(sceneId,selfId,"Trong quá trình sØa chæa", 8)
			end
			
		end
		
		LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, x805027_g_Impact_Complete_Repair, 0 )
			
		BeginEvent(sceneId)
		AddText(sceneId,"SØa chæa thành công")
		EndEvent(sceneId)
		DispatchMissionTips(sceneId,selfId)
		Msg2Player(sceneId,selfId,"#GSØa chæa thành công", 8)
	end	
end

--¼ÆËãÐÞÀí¼Û¸ñ
function x805027_CalRepairPrice( sceneId, selfId, itemId,targetId)
	
	local price = GetHighRepairPrice(sceneId, selfId, itemId)

	if price < 0 then
		price = 0
	end

	BeginUICommand(sceneId)
		UICommand_AddInt(sceneId,targetId)
		UICommand_AddInt(sceneId,price )
	EndUICommand(sceneId)
	DispatchUICommand(sceneId,selfId, 19810313)
end
